<!doctype html>
<html>
  <head>
    <title>projects</title>
    <link rel='stylesheet' href='../static/css/bootstrap.min.css'>

    <style>
      #sidebar {
        margin: 30px 0 0 0;
      }

      #project-types li {
        margin: 0 0 0 5px;
        cursor: pointer;
        color: '#0069D6';
      }

      .project {
        margin: 0 0 25px 0;
      }

      .embedded-content {
        text-align: center;
        margin: 15px 0 15px 0;
      }

      .thumb-container {
        height: 150px;
      }

      .thumb {
        cursor: pointer;
      }

      .expanded-project {
        padding: 0 0 20px 0;
      }

      .close-button {
        cursor: pointer;
      }
    </style>
  </head>

  <body>
    <div class='container'>
      <div class='row'>
        <div class='span16'>
          <div class='row'>

            <div id='sidebar' class='span2'>
              <p><a href='../'>home</a></p>
              <p><a href='../about'>about</a></p>
              <p>projects</p>
              <ul id='project-types' class='unstyled'>
                <li class='project-filter filter-selected' id='all'>all&nbsp;<span class='filter-selected-chevron'>&raquo;</span></li>
                <li class='project-filter' id='large'>large&nbsp;<span style='display: none' class='filter-selected-chevron'>&raquo;</span></li>
                <li class='project-filter' id='small'>small&nbsp;<span style='display: none' class='filter-selected-chevron'>&raquo;</span></li>
                <li class='project-filter' id='favorite'>favorite&nbsp;<span style='display: none' class='filter-selected-chevron'>&raquo;</span></li>
              </ul>
            </div> <!--/sidebar-->

            <!--history appended here-->

          </div>
        </div>
      </div><!--/row-->
    </div><!--/container-->
  
    <script src='http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js'></script>
    <script src='../static/js/mustache.js'></script>
    <script src='../static/js/jquery.smooth-scroll.min.js'></script>

    <script src='projects.js'></script>

    <script>
      var project_list_template = 
          "<div id='history' class='span14'>"
            // iterate through the years
            + "{{#history}}"
            + "<div class='row year' id='{{year}}'>"
              + "<h2 class='year-label'>{{year}}</h2>"
              // iterate through the year's projects
              + "{{#projects}}"
              // each tag is added as a class for this project
              + "<div class='project span4{{#tags}} {{.}}{{/tags}}'>"
                + "<div class='thumb-container'>"
                  + "{{#photos}}<img class='thumb expando' src={{thumb}} />{{/photos}}"
                + "</div><!--/thumb-container-->"
                + "<p class='title'>{{name}}</p>"
                + "<p>{{blurb}}</p>"
              + "</div>"
              + "{{/projects}}"
            + "</div>"
            + "{{/history}}"
          +"</div><!--/content-->";
      
      var project_expanded_template = 
          "<div id='{{name}}' class='expanded-project span12{{#tags}} {{.}}{{/tags}}'>"
            + "<h3>{{name}} <small>{{where}}</small>"
              // set an onclick method here for removing the expanded project as it cannot be registered onload
              + "<span class='close-button pull-right' onclick='remove_expanded($(this).parent().parent())'>"
                + "&times;</span></h3>"
            + "{{{expound}}}"
          + "</div><!--/expanded-project-->";


      $(function() {
        
        // populate the list
        var html = Mustache.to_html(project_list_template, projects);
        $('#sidebar').parent().append(html);
        
        // an image is clicked and we need to show some more info on this page
        $('.expando').click(function() {
          // clear out any expanded projects from this year
          $(this).parent().parent().siblings('.expanded-project').remove();

          // drill down to the correct project; first find the year
          for (m in projects['history']) {
            if (projects['history'][m]['year'] == $(this).parent().parent().parent().attr('id')) {
              // find the project 
              for (n in projects['history'][m]['projects']) {
                if (projects['history'][m]['projects'][n]['name'] == $(this).parent().siblings('.title').html()) {
                  var html = Mustache.to_html(project_expanded_template, projects['history'][m]['projects'][n]);
                  // add it to the top
                  $(this).parent().parent().siblings('.year-label').after(html);
                  
                  // scroll to the year
                  $.smoothScroll({
                    scrollTarget: $('#' + $(this).parent().parent().parent().attr('id'))
                    , speed: 500
                  });

                }
              }
            
            }
          }

        });


        $('.project-filter').click(function() {
          /* project sidebar filtering which projects are displayed based on the 'tags'
          */
          var filter = $(this).attr('id');
          if (filter == 'all') {
            $('.project').show();
            $('.filter-selected-chevron').hide();
            $(this).children('.filter-selected-chevron').show();

          } else if(filter != $('.project-filter.filter-selected').attr('id')) {  // wasn't already selected
            // show the relevant projects
            $('.project.' + filter).show();
            // hide all the ones that don't have this tag
            $('.project').not('.'+filter).hide();
            $('.expanded-project').not('.'+filter).remove();
            // move the selected class around
            $('.filter-selected').removeClass('filter-selected');
            $(this).addClass('filter-selected');
            $('.filter-selected-chevron').hide();
            $(this).children('.filter-selected-chevron').show();
          }
        });
        
      });

      function remove_expanded(expanded_project) {
        /* x-button sends the whole project as a jq object onclick
        */
        //expanded_project.slideUp();
        expanded_project.remove();
      }

    </script>

  </body>
</html>
